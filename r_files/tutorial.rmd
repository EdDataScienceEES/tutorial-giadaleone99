---
title: "Creating **static and interactive** maps in R for beginners"
author: "Giada Leone"
date: "14/11/2021"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
---

<br>

#### This tutorial is aimed at people who have little experience in using R and would like to try **spatial data visualisation** by using R as a GIS like software using specific packages. <br> <br> R is very powerful due to its wide applications in statistics, modelling, data visualisation and spatial data. In this tutorial we will be focussing on a specific type of spatial data: point data, and different ways to visualise it without diving into the theory behind more complex spatial objects such as line polygon and raster data. If you are interested in other types of spatial data have a look at the supplementary material at the end of the tutorial.

---

### Tutorial Aims:
##### 1. Data preparation and wrangling for spatial visualisation
##### 2. Creating basic maps with point data using ggplot2
##### 3. Creating interactive maps using the mapview package
##### 4. Challenge yourself try it on another dataset

---

Here is a quick introduction to spatial data

[![IMAGE ALT TEXT HERE](https://img.youtube.com/vi/F7U-nJj9yUg/0.jpg)](https://www.youtube.com/watch?v=F7U-nJj9yUg)


Once you open Rstudio you need to create a project to include all of the files related to this tutorial by clicking on the create a project symbol ![](../other/Rproj_screenshot.png) in the global toolbar at the top of an Rstudio window. Click on 'new directory' and 'new project' save the folder on your desktop and give it a descriptive name such as 'maps_tutorial'.

Your Rstudio project will open up and now you can create a new script by typing 'ctrl + shift + N' on windows or 'command + shift + N' on Mac or simply by using the global toolbar.

### Downloading the files

To download the necessary dataset you can clone or download the [repository](https://github.com/EdDataScienceEES/tutorial-giadaleone99) by clicking on the green 'Code' button and then clicking on 'download ZIP'. Next you can unzip the folder and move the data file 'beachwatch_data.csv' into the project folder/directory that you created previously.

This data is provided by the Great British Beach Clean ...

---

### Required packages

We will be using the ```tidyverse``` to do data wrangling and preparing the dataset, it also includes the ```ggplot2``` package which we will use for visualisation of point data.

The ```janitor``` package is a useful tool to clean datasets which will come in handy when handling public datasets which may have unorganised column names.


The ```leaflet``` package is quite similar to mapview, which does some of the same things, however, we will be creating a map in both because there are always different ways to do things in R.

The ```sf``` package will be used in combination with ```mapview```. Simple features include geometries like points and lines. If you have any troubles installing the ```sf``` package you can check out this link for suggestions: https://r-spatial.github.io/sf/ 

The package ```mapview``` is used to visualise spatial data in an interactive way in R. It is intended for quick and easy interactive visualisation as opposed to producing high quality presentation maps.

If you have never used these packages before you will need to install them by using the ```install.packages("packagename")``` function and include the names within the "" before loading them with the ```library(packagename)``` function.

```{r, warning=FALSE, message=FALSE}
# Libraries ----
# install.packages("tidyverse")
   
library(tidyverse)  # Data wrangling & includes ggplot2
library(janitor)    # Cleaning datasets
library(ggthemes)   # Themes for ggplot2
library(leaflet)    # Interactive map1
library(sf)         # Simple Features
library(mapview)    # Interactive map2
```

---

### Importing the dataset

Here we are importing the file 'beachwatch_data.csv' which you previously moved to your directory. We use the ```read.csv()``` function and assign the dataframe to object called 'beaches'. 

```{r, results='hide'}
beaches <- read.csv("../data/beachwatch_data.csv", header = TRUE)
str(beaches)  # Checking data structure
```

---

### Preparing the data

Here we are organising the data by firstly cleaning the column names with the clean_names() function from the janitor package. Next we are deleting the unnecessary columns from the dataframe as well as dropping columns which have NA values.


```{r}
# cleaning data frame column names
beaches <- beaches %>% clean_names() 

# deleting unused columns
beaches <- select(beaches,-seq(12, 109), -seq(112, 170))  

# dropping columns which have NA values
beaches <- drop_na(beaches)  

```

Changing data types: if variables are characters we are converting them to factors or 'categorical' data types, and if variables are integers we convert them to numeric. This is important for subsequent steps to work. R often requires variables to be a specific data type.

```{r}
beaches <- beaches %>% mutate_if(is.character, as.factor) %>% 
                       mutate_if(is.integer, as.numeric)

```

---

### Creating a static map with ggplot2

Let's use ggplot to create a map to show us all the beaches around the UK which have data from Great British Beach Clean surveys.

We will gradually make this map step by step so you can follow the map making process.

```{r}
# Basic world map
ggplot() +                                # Calling ggplot()
   borders("world", colour = "black") +   # Plotting world borders in black
   theme_map()                            # map theme (no long & lat, white background )
```
<br>
Next, we will zoom in to the UK by setting the x and y limits within the ```coord_cartesian()``` function.

```{r}
# Zoom in to UK 
ggplot() +
   borders("world", colour = "black") +
   coord_cartesian(xlim = c(-10, 3), ylim = c(50.3, 59)) +  # specifying coordinates to zoom
   theme_map()
```

<br>

Now that we have zoomed into our area of interest, we can plot the points of the UK beaches surveyed in the dataset by specifying the coordinates (longitude and latitude) of our points within the ```aes()``` function.

We also filled the land with a lightgrey colour to make it stand out more and coloured the background blue.

<br>

```{r}
# Adding spatial data points (beaches)
ggplot(beaches, aes(x = beach_longitude,
                    y = beach_latitude)) +
   borders("world", colour = "black", fill = "lightgrey") +  # changing the colour of the map
   coord_cartesian(xlim = c(-10, 3), ylim = c(50.3, 59)) +
   geom_point(size = 1) +
   theme_map() +
   theme(panel.background = element_rect(fill = "aliceblue"))
```

<br>

Here we are telling ggplot to colour the points depending on beach region for which we have a column in the dataset.

```{r}
# Colouring points based on beach region
ggplot(beaches, aes(x = beach_longitude,
                    y = beach_latitude,
                    colour = beach_region)) +                  # Colouring by beach region
   borders("world", colour = "black", fill = "lightgrey") +  
   coord_cartesian(xlim = c(-10, 3), ylim = c(50.3, 59)) +
   geom_point(size = 1) +
   theme_map() +
   theme(panel.background = element_rect(fill = "aliceblue"))  # Changing background colour
```

We can see that the default location of the legend overlaps with the map, so we move the legend by specifying the ```legend.position()``` withing the theme function. Here we also add an informative title and change the legend title and box.

```{r}
ggplot(beaches, aes(x = beach_longitude,
                    y = beach_latitude,
                    colour = beach_region)) +
   borders("world", colour = "black", fill = "lightgrey") +  
   coord_cartesian(xlim = c(-10, 3), ylim = c(50.3, 59)) +
   geom_point(size = 1) +
   theme_map() +
   theme(plot.title = element_text(size = 12, hjust = 0.5, face = 'bold'),  # title characteristics
         panel.background = element_rect(fill = "aliceblue"),
         legend.position = c(0.77, 0.45),                      
         legend.box.background = element_rect(color = 'grey', size = 0.5)) +  # Adding a border
   labs(colour = "UK Regions",  # Changing legend title
        title = "Great British Beach Clean surveys in the UK")  # Informative title
```



```{r}
(map <- ggplot(beaches,
               aes(x = beach_longitude,
                   y = beach_latitude, 
                   colour = beach_region)) +
   borders("world", colour = "grey5", fill = "black", size = 0.2) +
   coord_cartesian(xlim = c(-10, 3), ylim = c(50.3, 59)) +
   theme_map() +
   geom_point(size = 1) +
   theme(plot.title = element_text(size = 12, hjust = 0.5),
         legend.position = c(0.77, 0.4),
         legend.box.background = element_rect(color = 'grey', size = 0.5)) +
   labs(title = "Beach Locations by Region",
        colour = "UK Regions"))
```





Now for the more interactive part!


---

Spatial analysis 
```{r, results='hide', warning=FALSE}
beaches_obj <- st_as_sf(beaches, coords =  c('beach_longitude', 'beach_latitude'), crs = 4326)

# examine the sf object
beaches_obj
str(beaches_obj)

plot(beaches_obj)

plot(st_geometry(beaches_obj))
```

Interactive map 
```{r}
mapview(beaches_obj, zcol = 'beach_region')
```




### Supplementary material 
Here is an introduction to the different types of spatial data you could be working with in the future. 

[![IMAGE ALT TEXT HERE](https://img.youtube.com/vi/nVr4BC0C_oQ/0.jpg)](https://www.youtube.com/watch?v=nVr4BC0C_oQ)

